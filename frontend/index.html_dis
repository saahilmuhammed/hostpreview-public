<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>hostpreview.space</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    html, body {
      height: 100%; width: 100%; min-height: 100vh; margin: 0;
      font-family: system-ui, sans-serif;
    }
    body {
      position: relative;
      min-height: 100vh;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1;
      overflow: hidden;
    }
    .bg-wrapper {
      position: fixed;
      inset: 0;
      width: 100vw; height: 100vh; z-index: 0;
      background:
        linear-gradient(135deg, rgba(30,25,37,0.91) 0%, rgba(70,17,65,0.78) 80%, rgba(37,32,54,0.95) 100%),
        url('bright-purple-square-mosaic-textural-background.jpg') center center/cover no-repeat;
      filter: brightness(0.75) blur(0.5px);
    }
    .preview-modal {
      max-width: 470px;
      background: rgba(38,38,41,0.97);
      border-radius: 20px;
      color: #f4f4f4;
      padding: 2.7rem 2rem 2rem 2rem;
      margin: 2rem 1rem;
      box-shadow: 0 8px 36px 2px #0008;
      border: 1px solid #202028;
      width: 100%;
      position: relative;
      z-index: 2;
    }
    .preview-modal h2 {
      margin-bottom: 1.3rem;
      font-size: 1.5rem;
      font-weight: bold;
      text-align: center;
      letter-spacing: 0.01em;
    }
    label {
      font-size: 0.99rem;
      color: #cdcdcd;
      margin-bottom: 0.12rem;
      display: block;
    }
    .input-row { margin-bottom: 1.3rem; }
    .input-box {
      width: 100%;
      padding: 11px;
      border-radius: 8px;
      border: none;
      margin-top: 5px;
      background: #15141a;
      color: #e2e2e2;
      font-size: 1.08rem;
      outline: none;
      box-shadow: 0 1px 6px #0002;
    }
    .action-btn {
      background: #473cbd;
      color: #f2f2ff;
      border: none;
      font-weight: 600;
      border-radius: 8px;
      padding: 11px 38px;
      cursor: pointer;
      font-size: 1.11rem;
      display: block;
      margin: 0 auto 28px auto;
      box-shadow: 0 2px 12px #0008;
      transition: background 0.15s;
    }
    .action-btn:hover { background: #332ba9; }
    .result-wrap {
      margin-bottom: 0.6rem;
      text-align: center;
    }
    .result-link {
      word-break: break-all;
      display: inline-block;
      background: #18181c;
      color: #83abff;
      padding: 11px 16px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 1.07rem;
      margin-bottom: 0.75em;
      margin-top: 0.6em;
      text-decoration: none;
      outline: none;
      border: none;
      box-shadow: 0 1px 8px #0006;
      transition: background 0.14s;
    }
    .result-link:hover, .result-link:active {
      background: #252539;
      color: #dde6ff;
    }
    .copy-btn {
      background: #232359;
      color: #e3e8ff;
      border: none;
      font-weight: 500;
      border-radius: 8px;
      padding: 7px 23px;
      cursor: pointer;
      font-size: 1.01em;
      margin-left: 9px;
      margin-bottom: 0.3em;
      margin-top: 0.5em;
      transition: background 0.13s;
    }
    .copy-btn:hover { background: #373799; color: #fff; }
    .error-msg {
      text-align:center;
      color:#ff4b6e;
      margin-top:10px;
      margin-bottom:0;
      display:none;
    }
    @media (max-width: 600px) {
      .preview-modal { padding: 1rem 0.22rem 1.2rem 0.22rem; }
    }
  </style>
</head>
<body>
  <div class="bg-wrapper"></div>
  <div class="preview-modal">
    <h2>Preview Link Generator</h2>
    <form id="previewForm">
      <div class="input-row">
        <label for="ipInput">Server IP Address</label>
        <input class="input-box" type="text" id="ipInput" required placeholder="e.g. 1.2.3.4">
      </div>
      <div class="input-row">
        <label for="domainInput">Domain Name</label>
        <input class="input-box" type="text" id="domainInput" required placeholder="e.g. example.com">
      </div>
      <button type="submit" class="action-btn" id="generateBtn">Generate Preview</button>
    </form>
    <div id="result" style="display:none;">
      <div class="result-wrap">
        <label>Preview URL</label>
        <br>
        <a id="previewLink" class="result-link" href="#" target="_blank"></a>
        <br>
        <button class="copy-btn" onclick="copyURL()">Copy</button>
      </div>
    </div>
    <div id="errorMsg" class="error-msg"></div>
  </div>
  <script>
    // Best reliability: Use JS eventListener to PREVENT form reload
    document.getElementById('previewForm').onsubmit = function(e) {
      e.preventDefault();
      showPreview();
    };
    async function showPreview() {
      var ip = document.getElementById('ipInput').value.trim();
      var domain = document.getElementById('domainInput').value.trim();
      var resultDiv = document.getElementById('result');
      var errorMsg = document.getElementById('errorMsg');
      resultDiv.style.display = "none";
      errorMsg.style.display = "none";
      if (!ip || !domain) return false;
      document.getElementById('generateBtn').disabled = true;
      try {
        let resp = await fetch('/api/preview-link', {
          method: 'POST',
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({domain, ip})
        });
        if (resp.ok) {
          let data = await resp.json();
          let url = data.previewUrl;
          let siteUrl = location.origin + url;
          var link = document.getElementById('previewLink');
          link.href = siteUrl;
          link.textContent = siteUrl;
          resultDiv.style.display = "";
        } else {
          let err = await resp.json();
          errorMsg.textContent = err.detail || "Error generating preview URL";
          errorMsg.style.display = "";
        }
      } catch(e) {
        errorMsg.textContent = "Network or backend error.";
        errorMsg.style.display = "";
      }
      document.getElementById('generateBtn').disabled = false;
      return false;
    }
    function copyURL() {
      var link = document.getElementById('previewLink');
      var temp = document.createElement('input');
      document.body.appendChild(temp);
      temp.value = link.href;
      temp.select();
      temp.setSelectionRange(0, 99999);
      document.execCommand('copy');
      document.body.removeChild(temp);
      alert('Copied!');
    }
  </script>
</body>
</html>

